CREATE OR REPLACE TRIGGER TRIGGER_2
BEFORE INSERT ON
TAPS_MOVIES
FOR EACH ROW
DECLARE
C1 CONTRACTS%ROWTYPE;
BEGIN
  SELECT * INTO C1
  FROM
  CONTRACTS
  WHERE :NEW.CONTRACTID=CONTRACTID;
IF C1.STARTDATE>TO_DATE(:NEW.VIEW_DATETIME, 'DD-MM-YYYY') OR C1.ENDDATE<TO_DATE(:NEW.VIEW_DATETIME,'DD-MM-YYYY')
OR SYSDATE<TO_DATE(:NEW.VIEW_DATETIME,'DD-MM-YYYY')
THEN
RAISE_APPLICATION_ERROR(-20001,'DATE IS NOT CORRECT, IT IS OUT OF CONTRACT');
END IF;
END TRIGGER_2;
/

--Trigger done for series; we have decided to create two independent triggers for each case

CREATE OR REPLACE TRIGGER TRIGGER_2_1
BEFORE INSERT ON
TAPS_SERIES
FOR EACH ROW
DECLARE
C1 CONTRACTS%ROWTYPE;
BEGIN
  SELECT * INTO C1
  FROM
  CONTRACTS
  WHERE :NEW.CONTRACTID=CONTRACTID;
IF C1.STARTDATE>TO_DATE(:NEW.VIEW_DATETIME, 'DD-MM-YYYY') OR C1.ENDDATE<TO_DATE(:NEW.VIEW_DATETIME,'DD-MM-YYYY')
OR SYSDATE<TO_DATE(:NEW.VIEW_DATETIME,'DD-MM-YYYY')
THEN
RAISE_APPLICATION_ERROR(-20001,'DATE IS NOT CORRECT, IT IS OUT OF CONTRACT');
END IF;
END TRIGGER_2_1;
/
